// This file defines the Prisma schema for the Booklyn project
// Run `npx prisma migrate dev --name init` after editing


generator client {
  provider = "prisma-client-js"
}

enum Role {
  librarian
  client
}

enum BorrowStatus {
  reserved
  expired
  borrowed
  due_soon
  overdue
  returned
}

enum NotificationType {
  info
  warning
  success
  error
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String   @id @default(uuid())
  email           String   @unique
  password        String
  name            String
  role            Role
  avatar          String?
  remainingBorrows Int
  createdAt       DateTime @default(now())
  isActive        Boolean  @default(true)
  borrowRecords   BorrowRecord[]
  notifications   Notification[]
}

model Book {
  id              String   @id @default(uuid())
  title           String
  author          String
  category        String
  isbn            String   @unique
  totalCopies     Int
  availableCopies Int
  coverImage      String?
  description     String?
  publishedYear   Int?
  borrowRecords   BorrowRecord[]
}

model BorrowRecord {
  id                   String   @id @default(uuid())
  book                 Book     @relation(fields: [bookId], references: [id])
  bookId               String
  user                 User     @relation(fields: [userId], references: [id])
  userId               String
  status               BorrowStatus
  reservedAt           DateTime
  reservationExpiresAt DateTime
  pickupDate           DateTime?
  dueDate              DateTime?
  returnDate           DateTime?
  overduesDays         Int?
}

model Notification {
  id        String   @id @default(uuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  title     String
  message   String
  type      NotificationType
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
}
